<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trái tim đập - Phiên bản Thủ khoa Lý</title>
  <style>
    :root{--bg1:#ff9a9e;--bg2:#ffd1dc;--card:rgba(255,255,255,0.9);--accent:#ff4d6d}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{background:linear-gradient(135deg,var(--bg1),var(--bg2));display:flex;align-items:center;justify-content:center;padding:32px}
    .card{width:min(760px,96vw);padding:28px;border-radius:18px;background:var(--card);box-shadow:0 12px 30px rgba(0,0,0,0.12);text-align:center}
    h1{margin:0 0 8px;font-size:26px;color:#3a2b2b}
    p{margin:0 0 18px;color:#4b3333}

    .stage{position:relative;padding:28px 10px}

    /* main heart */
    .heart-svg{width:220px;height:220px;cursor:pointer;display:inline-block;filter:drop-shadow(0 18px 30px rgba(0,0,0,0.15));transition:transform 160ms ease}

    /* two-layer pulse: main scale + outer ring */
    .pulse-ring{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:240px;height:240px;border-radius:50%;pointer-events:none;opacity:0}
    .pulse-ring.show{animation:ring 700ms ease-out forwards}
    @keyframes ring{0%{transform:translate(-50%,-50%) scale(0.8);opacity:0.6}100%{transform:translate(-50%,-50%) scale(1.6);opacity:0}}

    /* heart beat animations */
    @keyframes bigBeat{0%{transform:scale(1)}30%{transform:scale(1.28)}45%{transform:scale(0.96)}70%{transform:scale(1.08)}100%{transform:scale(1)}}
    @keyframes smallBeat{0%{transform:scale(1)}30%{transform:scale(1.12)}45%{transform:scale(0.98)}100%{transform:scale(1)}}

    .heart-svg.big-beat{animation:bigBeat 520ms cubic-bezier(.2,.8,.2,1)}
    .heart-svg.small-beat{animation:smallBeat 360ms cubic-bezier(.2,.8,.2,1)}

    /* inner glow */
    .glow{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:260px;height:260px;border-radius:50%;filter:blur(18px);opacity:0.08;pointer-events:none}

    .controls{display:flex;gap:10px;justify-content:center;margin-top:14px;flex-wrap:wrap}
    button{padding:10px 14px;border-radius:10px;border:0;font-weight:600;cursor:pointer}
    .btn-soft{background:linear-gradient(180deg,rgba(255,255,255,0.95),rgba(255,255,255,0.9));}
    .btn-color{background:linear-gradient(90deg,var(--accent),#ff98b3);color:white}

    .note{font-size:13px;color:#6a4f4f;margin-top:12px}

    /* small hearts burst */
    .mini{position:fixed;pointer-events:none;z-index:9999}

    @media (max-width:480px){.heart-svg{width:160px;height:160px}.pulse-ring{width:180px;height:180px}}
  </style>
</head>
<body>
  <div class="card">
    <h1>Trái tim đập — Phiên bản "Thủ khoa Lý"</h1>
    <p>Click trái tim để nó đập theo nhịp "bùm-bụp" (mô phỏng kiểu trong phim/trend). Có sẵn nút bật/tắt tự đập liên tục.</p>

    <div class="stage">
      <div class="pulse-ring" id="ring"></div>
      <div class="glow" id="glow" style="background:radial-gradient(circle at 50% 40%, rgba(255,90,120,0.25), rgba(255,90,120,0.06));"></div>

      <!-- SVG heart (keeps same path for smooth scaling) -->
      <svg id="mainHeart" class="heart-svg" viewBox="0 0 32 29" role="img" aria-label="Trái tim">
        <defs>
          <linearGradient id="gA" x1="0%" x2="100%" y1="0%" y2="100%">
            <stop offset="0%" stop-color="#ff4d6d" />
            <stop offset="100%" stop-color="#ff98b3" />
          </linearGradient>
          <filter id="soften" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur stdDeviation="1.6" result="b" />
            <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
        </defs>
        <path id="hpath" d="M23.6 0c-2 0-3.8.9-4.9 2.3C17.2.9 15.4 0 13.4 0 9 0 5.9 3.4 5.9 7.6c0 6.2 9.3 11.5 12.6 13.6.5.3 1.1.3 1.6 0 3.4-2.2 12.6-7.5 12.6-13.6C35.8 3.4 32.8 0 28.4 0c-2 0-3.8.9-4.8 2.3C18.9.9 17.1 0 15.1 0z" fill="url(#gA)" transform="translate(-3 -0.5) scale(0.9)" filter="url(#soften)"/>
      </svg>
    </div>

    <div class="controls">
      <button class="btn-soft" id="toggleAuto">Bật tự đập</button>
      <button class="btn-color" id="colorize">Đổi palette</button>
      <button class="btn-soft" id="download">Tải HTML</button>
    </div>

    <div class="note">Gợi ý: nhấn trái tim để thử nhịp "bùm-bụp" (1 mạnh, 1 nhẹ). Bật "tự đập" để thấy loop.</div>
  </div>

  <script>
    const heart = document.getElementById('mainHeart');
    const ring = document.getElementById('ring');
    const toggleAuto = document.getElementById('toggleAuto');
    const colorize = document.getElementById('colorize');
    const downloadBtn = document.getElementById('download');
    let auto = false;
    let autoInterval = null;

    // one 'beat sequence' = strong beat then quick softer beat ("bùm - bụp")
    function beatOnce(){
      // strong beat
      heart.classList.remove('big-beat');
      void heart.offsetWidth; // restart
      heart.classList.add('big-beat');
      // show ring
      ring.classList.remove('show'); void ring.offsetWidth; ring.classList.add('show');
      // spawn mini hearts
      spawnMini(12);
      // schedule second small beat
      setTimeout(()=>{
        heart.classList.remove('small-beat'); void heart.offsetWidth; heart.classList.add('small-beat');
      }, 170);
    }

    // click to trigger single beat sequence
    heart.addEventListener('click', (e)=>{
      beatOnce();
    });

    // auto toggle
    toggleAuto.addEventListener('click', ()=>{
      auto = !auto;
      if(auto){
        toggleAuto.textContent = 'Tắt tự đập';
        // play a loop with rhythm: 800ms between sequences
        beatOnce();
        autoInterval = setInterval(beatOnce, 900);
      } else {
        toggleAuto.textContent = 'Bật tự đập';
        clearInterval(autoInterval); autoInterval = null;
      }
    });

    // palette options
    const palettes = [ ['#ff4d6d','#ff98b3'], ['#ff8a65','#ffd166'], ['#7b61ff','#a07bff'], ['#ff6b6b','#ffd1e0'] ];
    colorize.addEventListener('click', ()=>{
      const pick = palettes[Math.floor(Math.random()*palettes.length)];
      const stops = document.querySelectorAll('#gA stop');
      stops[0].setAttribute('stop-color', pick[0]);
      stops[1].setAttribute('stop-color', pick[1]);
      document.documentElement.style.setProperty('--accent', pick[0]);
      document.getElementById('glow').style.background = `radial-gradient(circle at 50% 40%, ${pick[0]}55, ${pick[1]}08)`;
    });

    // mini hearts burst
    function spawnMini(n){
      for(let i=0;i<n;i++){
        const el = document.createElement('div');
        el.className = 'mini';
        const size = 8 + Math.random()*12;
        el.style.width = size+'px'; el.style.height = size+'px';
        el.style.left = (window.innerWidth/2 - size/2 + (Math.random()-0.5)*60) + 'px';
        el.style.top = (window.innerHeight/2 - size/2 + (Math.random()-0.5)*40) + 'px';
        el.style.borderRadius = '50%';
        el.style.background = ['#ff5e99','#ffd166','#7b61ff','#ff8a65'][Math.floor(Math.random()*4)];
        document.body.appendChild(el);
        const dx = (Math.random()-0.5)*200;
        const dy = - (80 + Math.random()*220);
        const dur = 900 + Math.random()*700;
        el.animate([
          {transform: 'translate(0,0) scale(1)', opacity:1},
          {transform: `translate(${dx}px, ${dy}px) scale(0.6)`, opacity:0}
        ], {duration: dur, easing: 'cubic-bezier(.2,.8,.2,1)'}).onfinish = ()=>el.remove();
      }
    }

    // download page
    downloadBtn.addEventListener('click', ()=>{
      const html = `<!doctype html>${document.documentElement.outerHTML}`;
      const blob = new Blob([html],{type:'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'trai_tim_thu_khoa_ly.html'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    // keyboard accessibility
    heart.setAttribute('tabindex','0');
    heart.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); heart.click(); } });

    // optional: start with a gentle single pulse to show effect
    setTimeout(()=>{ heart.classList.add('small-beat'); setTimeout(()=>heart.classList.remove('small-beat'),400); },600);
  </script>
</body>
</html>
